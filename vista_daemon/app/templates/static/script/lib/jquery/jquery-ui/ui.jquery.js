angular.module("ui.jquery",["ui.jquery.tabs","ui.jquery.slider","ui.jquery.popMenu","ui.jquery.popSound","ui.jquery.popTransCode","ui.jquery.date","ui.jquery.stream"]),angular.module("ui.jquery.tabs",[]).directive("tabs",function(){return{restrict:"A",scope:{active:"&?",hide:"&?",show:"&?",activate:"&?",beforeActivate:"&?",beforeLoad:"&?",load:"&?"},link:function(e,t){angular.element(t).tabs({active:e.active||null,hide:e.hide||null,show:e.show||null,activate:e.activate||null,beforeActivate:e.beforeActivate||null,beforeLoad:e.beforeLoad||null,load:e.load||null})}}}),angular.module("ui.jquery.slider",[]).directive("slider",function(){return{restrict:"EA",scope:{type:"@",showBox:"@",min:"@",max:"@",step:"@",sliderClass:"@",hoverClass:"@",barClass:"@",boxClass:"@",onDown:"=",onMove:"=",onUp:"=",currentValue:"=",tip:"=",dis:"="},link:function(e,t){var i,n=function(){e.currentValue=i.getValue(),e.$parent.$$phase||e.$parent.$apply(),angular.isFunction(e.onUp)&&e.onUp.call(this)};i=angular.element(t).slider({type:e.type||"slider",showBox:e.showBox?"true"===e.showBox:!1,min:e.min?parseInt(e.min,10):0,max:e.max?parseInt(e.max,10):100,step:e.step?parseInt(e.step,10):1,sliderCss:e.sliderClass||"slider",hoverCss:e.hoverClass||"sliderhover",barCss:e.barClass||"sliderbar",boxCss:e.boxClass||"sliderbox",onstart:e.onDown||null,onchange:e.onMove||null,onend:n}),e.$watch("currentValue",function(t){angular.isDefined(t)&&(i.setValue(t),angular.isDefined(e.tip)&&i.setTitle(e.tip+":"+t))}),e.$watch("min",function(t){angular.isDefined(t)&&(i.setMinMax(parseInt(t,10),parseInt(e.max,10)),i.setValue(e.currentValue))}),e.$watch("max",function(t){angular.isDefined(t)&&(i.setMinMax(parseInt(e.min,10),parseInt(t,10)),i.setValue(e.currentValue))}),e.$watch("dis",function(e){angular.isDefined(e)&&i.setDisabled(e)})}}}),angular.module("ui.jquery.popMenu",[]).controller("popMenuController",function($scope){$scope.modeChange=function(e){$scope.onMenuChange&&($scope.onMenuChange(e),"5"===$scope.type&&$(".pop-menu, .iframe-menu").hide())},this.showPopMenu=function(e){e?($(".pop-menu").hide(),$("#pop_menu_"+$scope.type+", #iframe_menu_"+$scope.type).css({left:$("#"+$scope.targetId).offset().left,top:$("#"+$scope.targetId).offset().top+$("#"+$scope.targetId).outerHeight()}).show()):$("#pop_menu_"+$scope.type+", #iframe_menu_"+$scope.type).hide(),$("#iframe_menu_"+$scope.type).css({width:$("#pop_menu_"+$scope.type).outerWidth(),height:$("#pop_menu_"+$scope.type).outerHeight()})}}).directive("popMenu",function($compile,$document){return{restrict:"A",scope:{targetId:"@",onMenuChange:"=",type:"@",num:"=",lan:"="},require:"popMenu",controller:"popMenuController",link:function(e,t,i,n){if("1"===e.type)var a='<div id="pop_menu_1" class="pop-menu"><button class="btn" type="button" ng-click="modeChange(1)" title="1x1"><i class="icon-wnd-1"></i></button><button class="btn" type="button" ng-click="modeChange(2)" title="2x2"><i class="icon-wnd-2"></i></button><button class="btn" type="button" ng-click="modeChange(3)" title="3x3"><i class="icon-wnd-3"></i></button><button class="btn" type="button" ng-click="modeChange(4)" title="4x4"><i class="icon-wnd-4"></i></button></div><iframe id="iframe_menu_1" class="iframe-menu" scrolling="no" frameborder="0"></iframe>';else if("2"===e.type){for(var o=["mainStream","subStream","thirdStream","fourthStream","fifthStream"],a='<div id="pop_menu_2" class="pop-menu">',r=1;e.num>=r;++r)a+='<button class="btn" type="button" ng-click="modeChange('+r+')" title="'+e.lan[o[r-1]]+'"><i class="icon-stream-'+r+'"></i></button>';a+='</div><iframe id="iframe_menu_2" class="iframe-menu" scrolling="no" frameborder="0"></iframe>'}else if("3"===e.type)var a='<div id="pop_menu_3" class="pop-menu"><button class="btn" type="button" ng-click="modeChange(1)" title="4:3"><i class="icon-size-1"></i></button><button class="btn" type="button" ng-click="modeChange(2)" title="16:9"><i class="icon-size-2"></i></button><button class="btn" type="button" ng-click="modeChange(3)" title="'+e.lan.original+'"><i class="icon-size-3"></i></button>'+'<button class="btn" type="button" ng-click="modeChange(4)" title="'+e.lan.auto+'"><i class="icon-size-4"></i></button>'+"</div>"+'<iframe id="iframe_menu_3" class="iframe-menu" scrolling="no" frameborder="0"></iframe>';else if("4"===e.type){var a='<div id="pop_menu_4" class="pop-menu">';a+='<button class="btn" type="button" ng-click="modeChange(4)"><i class="icon-plugin-4" title="Webcomponents"></i></button>',a+='<button class="btn" type="button" ng-click="modeChange(1)"><i class="icon-plugin-1" title="QuickTime"></i></button>',$.browser.msie||(a+='<button class="btn" type="button" ng-click="modeChange(2)"><i class="icon-plugin-2" title="VLC"></i></button>',a+='<button class="btn" type="button" ng-click="modeChange(3)"><i class="icon-plugin-3" title="MJPEG"></i></button>'),a+='</div><iframe id="iframe_menu_4" class="iframe-menu" scrolling="no" frameborder="0"></iframe>'}else if("5"===e.type){for(var a='<div id="pop_menu_5" class="pop-menu">',r=0;parseInt(e.num,10)>r;r++){var s=e.lan.talkChannel+" "+(r+1);a+='<button class="btn" title="'+s+'" type="button" ng-click="modeChange('+(r+1)+')"><i class="icon-talk-'+(r+1)+'"></i></button>'}a+='</div><iframe id="iframe_menu_5" class="iframe-menu" scrolling="no" frameborder="0"></iframe>'}var l=$compile(a)(e);$document.find("body").append(l),$("#"+e.targetId).click(function(t){$("#"+e.targetId).find("i").eq(0).hasClass("on")?e.onMenuChange(0):n.showPopMenu(!0),t.stopPropagation()}),$("#pop_menu_"+e.type).click(function(e){e.stopPropagation()}),$document.on("click",function(){n.showPopMenu(!1)}),$(window).on("resize",function(){$(".pop-menu, .iframe-menu").hide()})}}}),angular.module("ui.jquery.popSound",[]).controller("popSoundController",function($scope){var e=0;$scope.bSound=$scope.sound,$scope.changeSound=function(){e=this.getValue(),$scope.bSound&&0==e?($scope.bSound=!1,$scope.onOpenSound&&$scope.onOpenSound()):!$scope.bSound&&e>0&&($scope.bSound=!0,$scope.onOpenSound&&($scope.bSound?$scope.onOpenSound()||(e=0,$scope.oSlider.setValue(e),$scope.bSound=!1):$scope.onOpenSound())),$scope.oSlider.setTitle(e),$scope.onChangeSound&&$scope.onChangeSound(e),$scope.$apply()},$scope.openSound=function(){$scope.bSound=!$scope.bSound,$scope.bSound||($scope.oSlider.setValue(0),$scope.oSlider.setTitle(0)),$scope.onOpenSound&&($scope.bSound?$scope.onOpenSound()?$scope.onChangeSound&&(e=50,$scope.oSlider.setValue(e),$scope.oSlider.setTitle(e),$scope.onChangeSound(e)):(e=0,$scope.oSlider.setValue(e),$scope.oSlider.setTitle(e),$scope.bSound=!1):$scope.onOpenSound())},$scope.$watch("sound",function(t){$scope.bSound=t,$scope.bSound?($scope.oSlider.setValue(e),$scope.oSlider.setTitle(e)):($scope.oSlider.setValue(0),$scope.oSlider.setTitle(0))}),this.showPopSound=function(e){var t=$(window).width(),i=$("#pop_sound").outerWidth(),n=$("#"+$scope.targetId).offset().left;n+i>t&&(n=t-i-10),e?$("#pop_sound, #iframe_sound").css({left:n,top:$("#"+$scope.targetId).offset().top+$("#"+$scope.targetId).outerHeight()}).show():$("#pop_sound, #iframe_sound").css({left:n,top:$("#"+$scope.targetId).offset().top+$("#"+$scope.targetId).outerHeight()}).hide(),$("#iframe_sound").css({width:$("#pop_sound").outerWidth(),height:$("#pop_sound").outerHeight()})}}).directive("popSound",function($document){return{restrict:"A",scope:{targetId:"@",width:"@",sound:"=",onChangeSound:"=",onOpenSound:"="},template:'<div id="pop_sound" class="pop-sound"><i ng-class="{true:\'icon-sound on\', false:\'icon-sound\'}[bSound]" ng-click="openSound()"></i><div id="pop_sound_slider"></div></div><iframe id="iframe_sound" class="iframe-sound" scrolling="no" frameborder="0"></iframe>',require:"popSound",controller:"popSoundController",link:function(e,t,i,n){$document.find("body").append(t),$("#pop_sound, #iframe_sound").css({width:e.width?parseInt(e.width,10):120}),$("#pop_sound_slider").css({width:$("#pop_sound").width()-30,marginTop:3,marginLeft:25}),e.oSlider=$("#pop_sound_slider").slider({showBox:e.showBox?"true"===e.showBox:!1,min:e.min?parseInt(e.min,10):0,max:e.max?parseInt(e.max,10):100,step:e.step?parseInt(e.step,10):1,sliderCss:e.sliderClass||"slider",hoverCss:e.hoverClass||"sliderhover",barCss:e.barClass||"sliderbar",boxCss:e.boxClass||"sliderbox",onstart:e.onDown||null,onchange:e.onMove||null,onend:e.changeSound||null}),$("#pop_sound").click(function(e){e.stopPropagation()}),$("#"+e.targetId).click(function(e){n.showPopSound(!0),e.stopPropagation()}),$document.on("click",function(){n.showPopSound(!1)}),$(window).on("resize",function(){$("#pop_sound, #iframe_sound").hide()})}}}),angular.module("ui.jquery.popTransCode",[]).controller("popTransCodeController",function($scope){$scope.iTransCodeResolution=255,$scope.iTransCodeBitrate=23,$scope.iTransCodeFrame=0,$scope.changeTransCode=function(){$scope.onChangeTransCode&&$scope.onChangeTransCode($scope.iTransCodeResolution,$scope.iTransCodeBitrate,$scope.iTransCodeFrame)},this.showPopTransCode=function(e){e?$("#pop_trans_code, #iframe_trans_code").css({left:$("#"+$scope.targetId).offset().left,top:$("#"+$scope.targetId).offset().top+$("#"+$scope.targetId).outerHeight()}).show():$("#pop_trans_code, #iframe_trans_code").css({left:$("#"+$scope.targetId).offset().left,top:$("#"+$scope.targetId).offset().top+$("#"+$scope.targetId).outerHeight()}).hide(),$("#iframe_trans_code").css({width:$("#pop_trans_code").outerWidth(),height:$("#pop_trans_code").outerHeight()})}}).directive("popTransCode",function($compile,$document){return{restrict:"A",scope:{targetId:"@",onOpenTransCode:"=",onChangeTransCode:"=",lan:"=",transCode:"=",transCodeResolution:"="},require:"popTransCode",controller:"popTransCodeController",link:function(e,t,i,n){var a='<div id="pop_trans_code" class="pop-trans-code"><table cellpadding="0" cellspacing="5" border="0"><tr><td ng-bind="lan.resolution"></td><td><select class="select" ng-model="iTransCodeResolution" ng-change="changeTransCode()">',o={255:e.lan.auto,1:"CIF",2:"QCIF",3:"4CIF"};e.transCodeResolution&&($.each(e.transCodeResolution,function(){a+='<option value="'+this+'">'+o[this]+"</option>"}),e.iTransCodeResolution=e.transCodeResolution[0]),a+='</select></td></tr><tr><td ng-bind="lan.bitRate"></td><td><select class="select" ng-model="iTransCodeBitrate" ng-change="changeTransCode()"><option value="2">32K</option><option value="3">48K</option><option value="4">64K</option><option value="5">80K</option><option value="6">96K</option><option value="7">128K</option><option value="8">160K</option><option value="9">192K</option><option value="10">224K</option><option value="11">256K</option><option value="12">320K</option><option value="13">384K</option><option value="14">448K</option><option value="15">512K</option><option value="16">640K</option><option value="17">768K</option><option value="18">896K</option><option value="19">1024K</option><option value="20">1280K</option><option value="21">1536K</option><option value="22">1792K</option><option value="23">2048K</option><option value="24">3072K</option><option value="25">4096K</option><option value="26">8192K</option></select></td></tr><tr><td ng-bind="lan.frameRate"></td><td><select class="select" ng-model="iTransCodeFrame" ng-change="changeTransCode()"><option value="0" ng-bind="lan.fullFrameRate"></option><option value="5">1</option><option value="6">2</option><option value="7">4</option><option value="8">6</option><option value="9">8</option><option value="10">10</option><option value="11">12</option><option value="12">16</option><option value="14">15</option><option value="15">18</option><option value="13">20</option><option value="16">22</option></select></td></tr></table></div><iframe id="iframe_trans_code" class="iframe-trans-code" scrolling="no" frameborder="0"></iframe>';var r=$compile(a)(e);$document.find("body").append(r),$("#"+e.targetId).click(function(t){t.stopPropagation(),e.onOpenTransCode&&e.onOpenTransCode()&&n.showPopTransCode(!0)}),$("#"+e.targetId).mouseover(function(){e.transCode&&n.showPopTransCode(!0)}),$("#pop_trans_code").click(function(e){e.stopPropagation()}),$document.on("click",function(){n.showPopTransCode(!1)}),$(window).on("resize",function(){$("#pop_trans_code, #iframe_trans_code").hide()})}}}),angular.module("ui.jquery.date",[]).directive("date",function(){return{restrict:"A",scope:{onPicked:"=",dpModel:"=",dpDisabled:"=",mode:"@"},link:function(e,t){var i,n=$.cookie("language");null===n&&(n="en"),"zh"===n?n="zh-cn":"zh_TW"===n&&(n="zh-tw");var a=function(){var t=this;e.$apply(function(){e.dpModel=t.value}),angular.isFunction(e.onPicked)&&e.onPicked.call(t)},o=function(e,t){var n=t?t.currentTarget:null;n&&"#document"==n.nodeName&&(e.el.value=i)};t.bind("click",function(){if(i=this.value,"1"===e.mode)WdatePicker({startDate:"%y-%M-%d",dateFmt:"yyyy-MM-dd",alwaysUseStartDate:!1,minDate:"1970-01-01 00:00:00",maxDate:"2037-12-31 23:59:59",readOnly:!0,lang:n,isShowClear:!1,onpicked:a,onClose:o}),WdatePicker({startDate:"%y-%M-%d",dateFmt:"yyyy-MM-dd",alwaysUseStartDate:!1,minDate:"1970-01-01 00:00:00",maxDate:"2037-12-31 23:59:59",readOnly:!0,lang:n,isShowClear:!1,onpicked:a,onClose:o});else if("2"===e.mode)WdatePicker({startDate:"%y-%M-%d %h:%m:%s",dateFmt:"yyyy-MM-ddTHH:mm:ss",alwaysUseStartDate:!1,minDate:"1970-01-01 00:00:00",maxDate:"2037-12-31 23:59:59",readOnly:!0,lang:n,isShowClear:!1,isShowToday:!1,onpicked:a,onClose:o}),WdatePicker({startDate:"%y-%M-%d %h:%m:%s",dateFmt:"yyyy-MM-ddTHH:mm:ss",alwaysUseStartDate:!1,minDate:"1970-01-01 00:00:00",maxDate:"2037-12-31 23:59:59",readOnly:!0,lang:n,isShowClear:!1,isShowToday:!1,onpicked:a,onClose:o});else if("3"===e.mode){for(var t=[],r=parseInt($(this).val().split(":")[0],10)-1,s="",l=0;5>l;l++)s=0==l%2?(r+l/2>9?r+l/2:"0"+(r+l/2))+":00:00":(r+(l-1)/2>9?r+(l-1)/2:"0"+(r+(l-1)/2))+":30:00",t.push(s);WdatePicker({dateFmt:"HH:mm:ss",isShowToday:!1,isShowClear:!1,alwaysUseStartDate:!1,readOnly:!0,lang:n,onpicked:a,quickSel:t,onClose:o}),WdatePicker({dateFmt:"HH:mm:ss",isShowToday:!1,isShowClear:!1,alwaysUseStartDate:!1,readOnly:!0,lang:n,onpicked:a,quickSel:t,onClose:o})}else WdatePicker({startDate:"%y-%M-%d %h:%m:%s",dateFmt:"yyyy-MM-dd HH:mm:ss",alwaysUseStartDate:!1,minDate:"1970-01-01 00:00:00",maxDate:"2037-12-31 23:59:59",readOnly:!0,lang:n,isShowClear:!1,onpicked:a,onClose:o}),WdatePicker({startDate:"%y-%M-%d %h:%m:%s",dateFmt:"yyyy-MM-dd HH:mm:ss",alwaysUseStartDate:!1,minDate:"1970-01-01 00:00:00",maxDate:"2037-12-31 23:59:59",readOnly:!0,lang:n,isShowClear:!1,onpicked:a,onClose:o})}),e.$watch("dpModel",function(e){t.val(e)}),e.$watch("dpDisabled",function(e){angular.isDefined(e)&&t.prop("disabled",e)})}}}),angular.module("ui.jquery.stream",[]).directive("stream",function($compile){return{restrict:"A",scope:{streamType:"=",lan:"=",num:"=",onChange:"=",channelIndex:"@"},link:function(e,t){if(angular.isDefined(e.streamType)){e.changeStreamType=function(t){e.streamType=t,o.hide()};var i="<div class='icon-stream' ng-class=\"{0: 'icon-stream-1', 1: 'icon-stream-2', 2: 'icon-stream-3'}[streamType]\"></div>",n=$compile(i)(e);n.bind({mouseenter:function(){$(this).addClass("stream-enter"),o.show(),o.css({left:n.position().left-o.outerWidth(!0)+1+"px",top:n.position().top-o.height()+n.outerHeight(!0)+"px"})},mouseleave:function(){$(this).removeClass("stream-enter"),o.hide()}}),t.append(n);var a="<div class='stream-select'><div class='stream-option' ng-click='changeStreamType(0)'>&nbsp;<span class='icon-stream icon-stream-1'></span><span class='stream-desc' title='{{lan.mainStream}}' ng-bind='lan.mainStream'></span></div><div class='stream-option' ng-click='changeStreamType(1)'>&nbsp;<span class='icon-stream icon-stream-2'></span><span class='stream-desc' title='{{lan.subStream}}' ng-bind='lan.subStream'></span></div>";3===e.num?a+="<div class='stream-option-last' ng-click='changeStreamType(2)'>&nbsp;<span class='icon-stream icon-stream-3'></span><span class='stream-desc' title='{{lan.thirdStream}}' ng-bind='lan.thirdStream'></span></div>":4===e.num&&(a+="<div class='stream-option-last' ng-click='changeStreamType(2)'>&nbsp;<span class='icon-stream icon-stream-3'></span><span class='stream-desc' title='{{lan.transcodedStream}}' ng-bind='lan.transcodedStream'></span></div>"),a+="</div>";var o=$compile(a)(e);o.bind({mouseenter:function(){$(this).show(),n.addClass("stream-enter")},mouseleave:function(){$(this).hide(),n.removeClass("stream-enter")}}),o.children("div").each(function(){$(this).bind({mouseenter:function(){$(this).addClass("stream-option-enter")},mouseleave:function(){$(this).removeClass("stream-option-enter")}})}),t.append(o);var r=parseInt(e.channelIndex,10);e.$watch("streamType",function(t){angular.isDefined(t)&&e.onChange&&(isNaN(r)||e.onChange(r,t))})}}}});