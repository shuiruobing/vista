define(function(require,exports,module){function e(){d={szRtsp:"false",szWeb:"basic"},c={oRtsp:null,oWeb:null}}var t,i,a,n,o,r,s,l,d,c,m,u;t=require("jquery"),i=require("common"),a=require("translator"),n=require("utils"),o=require("lib/dialog"),r=require("isapi/device"),s=require("isapi/response"),m=require("webSession"),u=require("base64"),e.prototype={init:function(){var e=this;e.initController()},initController:function(){var e=this;angular.module("securityAuthApp",[]).controller("securityAuthController",function($scope,$timeout){l=$scope,$scope.oLan=a.oLastLanguage,$scope.oSupportAuth=r.m_oDeviceCapa.oSupportAuth,$scope.oAuth=d,$scope.save=function(){e.save()},$timeout(function(){e.getAuthInfo()},10)}),angular.bootstrap(angular.element("#securityAuth"),["securityAuthApp"])},getAuthInfo:function(){l.oSupportAuth.bRtsp&&WebSDK.WSDK_GetDeviceConfig(i.m_szHostName,"rtspAuth",null,{success:function(e,i){c.oRtsp=i;var a=t(i).find("Security").eq(0).find("enabled").eq(0).text();d.szRtsp=""==a?"false":a,l.$apply()}}),l.oSupportAuth.bWeb&&WebSDK.WSDK_GetDeviceConfig(i.m_szHostName,"webAuth",null,{success:function(e,i){c.oWeb=i;var a=t(i).find("CertificateType").eq(0).text();d.szWeb=a,l.$apply()}})},save:function(){var e=this;e.setAuthInfo()},setAuthInfo:function(){var e=0,n=c.oWeb,r=t(n).find("CertificateType").eq(0).text(),p=d.szWeb;if(l.oSupportAuth.bWeb&&r!=p?(t(n).find("CertificateType").eq(0).text(p),WebSDK.WSDK_SetDeviceConfig(i.m_szHostName,"webAuth",null,{data:n,success:function(){var e=m.getItem("userInfo");if(null==e)return window.location.href="login.html?_"+(new Date).getTime(),void 0;var t=u.decode(e),n=i.parseNamePwd(t);i.m_bDigest="digest"===p?!0:!1,i.changeNamePWD(i.m_bAnonymous,n.szName,n.szPass),WebSDK.WSDK_SetDeviceConfig(i.m_szHostName,"deviceInfo",null,{username:n.szName,password:n.szPass,success:function(){}}),o.alert(a.getValue("restartBrowser"))},complete:function(t,i,a){e++,2==e&&s.saveState(a)}})):e++,l.oSupportAuth.bRtsp){var n=c.oRtsp;t(n).find("Security").eq(0).find("enabled").eq(0).text(d.szRtsp),WebSDK.WSDK_SetDeviceConfig(i.m_szHostName,"rtspAuth",null,{data:n,complete:function(t,i,a){e++,2==e&&s.saveState(a)}})}else e++}},module.exports=new e});