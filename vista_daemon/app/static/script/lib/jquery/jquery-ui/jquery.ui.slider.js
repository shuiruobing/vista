define(function(require){var e=require("jquery");(function(e){e.fn.slider=function(t){function i(){var e=Math.round((u-l.min)*C);v.css("left",e+"px"),f.width(e+Math.round(v.outerWidth(!0)/2))}function n(t){_=t.pageX,I=u,s(l.onstart),e(document).bind("mousemove",function(e){m||a(e)}),e(document).bind("mouseup",function(e){m||o(e)})}function a(t){if(e(d).is(":hidden"))return o(t),void 0;window.getSelection?window.getSelection().removeAllRanges():window.document.selection.empty();var n=t.pageX-_,a=u;u=Math.round(n/C)+I,l.step>1&&u!==l.min&&u!==l.max&&0!=u%l.step&&(u=Math.ceil(u/l.step)*l.step),l.min>u&&(u=l.min),u>l.max&&(u=l.max),u!==a&&(i(),l.showBox&&("process"===l.type?S.val(u+"%"):S.val(u)),s(l.onchange))}function o(){e(document).unbind("mousemove"),e(document).unbind("mouseup"),_=0,s(l.onend)}function r(e){var t=e.pageX-parseInt(g.offset().left,10)-Math.round(v.outerWidth(!0)/2),n=u;u=Math.round(t/C)+l.min,l.step>1&&u!==l.min&&u!==l.max&&0!=u%l.step&&(u=Math.ceil(u/l.step)*l.step),l.min>u&&(u=l.min),u>l.max&&(u=l.max),u!==n&&(i(),l.showBox&&("process"===l.type?S.val(u+"%"):S.val(u)),s(l.onchange),s(l.onend))}function s(t){return e.isFunction(t)?(t.call(d),void 0):!1}var l=e.extend({hints:"",type:"slider",sliderCss:"slider",hoverCss:"sliderhover",barCss:"sliderbar",boxCss:"sliderbox",min:0,max:100,showBox:!1,step:1,onstart:null,onchange:null,onend:null},t);if(l.min>l.max){var c=l.min;l.min=l.max,l.max=c}l.step>l.max&&(l.step=l.max);var u=l.min,d=this,p=4,m=!1;e(d).empty();var h=e("<div style='position: relative; margin: 0; padding: 0;'></div>");e(d).append(h);var g=e("<div style='position: absolute;'></div>");g.addClass(l.sliderCss),"process"!==l.type&&g.click(function(e){m||r(e)}),g.resize(function(){g&&(C=parseFloat((g.width()-v.outerWidth(!0))/(l.max-l.min)),l.showBox&&S.css("left",g.outerWidth(!0)+p),i())}),h.append(g);var f=e("<div style='position: absolute;'></div>");f.addClass(l.sliderCss),f.addClass(l.hoverCss).width(0),"process"!==l.type&&f.click(function(e){m||r(e)}),h.append(f);var v=e("<div style='position: absolute;'></div>");if("process"!==l.type&&(v.addClass(l.barCss),v.mousedown(function(t){m||(e(this).focus(),n(t))}),h.append(v)),l.showBox){var S=e("<input type='text' style='position: absolute;' />");S.attr("maxLength",(""+l.max).length),S.addClass(l.boxCss),S.val(l.min),S.css("left",g.outerWidth(!0)+p+"px"),"process"!==l.type?S.bind({click:function(){isNaN(parseInt(e(this).val(),10))?(e(this).val(l.min),u=l.min):u=parseInt(e(this).val(),10)},keydown:function(t){13==t.which&&e(this).blur()},keyup:function(t){var i=e(this).val();if(""!==i){var n=parseInt(i,10);isNaN(n)?e(this).val(l.min):(38==t.which?(n+=l.step,n=n>l.max?l.max:n):40==t.which&&(n-=l.step,n=l.min>n?l.min:n),e(this).val(n))}},blur:function(){var t=e(this).val(),i=l.min;/^[1-9]\d*|0$/.test(t)&&(i=parseInt(t,10),i=i>l.max?l.max:l.min>i?l.min:i,i!==l.min&&i!==l.max&&0!=i%l.step&&(i=Math.ceil(i/l.step)*l.step)),i===u?i!==parseInt(t,10)&&e(this).val(i):(d.setValue(i),s(l.onchange),s(l.onend))}}):(S.prop("readonly",!0),S.css("border","0px"),S.css("background","transparent")),h.append(S)}0===g.width()&&(l.showBox?(g.width(e(d).width()-S.outerWidth(!0)-p),S.css("left",g.outerWidth(!0)+p+"px")):g.css("width","100%"));var P=0,b=0;l.showBox?(P=Math.round((S.outerHeight(!0)-g.outerHeight(!0))/2+.5),b=Math.round((S.outerHeight(!0)-v.outerHeight(!0))/2+.5),h.height(S.outerHeight(!0))):(P=Math.round((v.outerHeight(!0)-g.outerHeight(!0))/2),h.height(v.outerHeight(!0))),g.css("top",P+"px"),f.css("top",P+"px"),v.css("top",b+"px");var C=parseFloat((g.width()-v.outerWidth(!0))/(l.max-l.min)),_=0,I=l.min;return e.extend(d,{getValue:function(){return u},setValue:function(e){if("number"!=typeof e&&(e=parseInt(e,10)),!isNaN(e)&&e!==u){var t=u;e=e>l.max?l.max:l.min>e?l.min:e,e!==t&&(u=e,i(),l.showBox&&("process"===l.type?S.val(u+"%"):S.val(u)))}},setTitle:function(e){g.attr("title",e),v.attr("title",e),f.attr("title",e)},setMinMax:function(e,t){"number"!=typeof e&&(e=parseInt(e,10)),"number"!=typeof t&&(t=parseInt(t,10));var i=!1;isNaN(e)||e===l.min||(l.min=e,i=!0),isNaN(t)||t===l.max||(l.max=t,i=!0),i&&g.resize()},setDisabled:function(e){m=e,S&&S.prop("disabled",e)}}),d}})(e)});