(function(e){e.fn.Menu=function(t){function i(t,a,o){t.each(function(t){var c=o+t+"_";e(this).addClass("menu").addClass("menu-"+a);var p=e(this).children("div:not(.not-menu)");p.length>0?(e(this).addClass("collapsed"),p.eq(0).addClass("menu-title").addClass("menu-title-"+a).css("padding-left",a*u+"px").hover(function(){e(this).parent().hasClass("menu-select")||e(this).addClass("menu-hover")},function(){e(this).removeClass("menu-hover")}),p.length>1&&(p.not(":first").each(function(){0===e(this).children("div:not(.not-menu)").length&&e(this).css("padding",d+"px 0 "+d+"px "+(a+1)*u+"px")}),i(p.not(":first"),a+1,c))):e(this).hover(function(){e(this).hasClass("collapsed")&&!e(this).hasClass("menu-select")&&e(this).addClass("menu-hover")},function(){e(this).removeClass("menu-hover")}),e(this).click(function(t){if(s.oneSmOnly&&!e(this).hasClass("cannot-select")){var i=e(this);p.length>1&&a>1&&(i=i.parent()),i.siblings(":not(.not-menu)").not(".collapsed").each(function(){e(this).addClass("collapsed"),e(this).find("div:not(.menu-title, .not-menu)").not(".collapsed").addClass("collapsed")})}if(p.length>1)e(this).toggleClass("collapsed"),0===e(this).find("div.menu-select").length&&(p.not(".cannot-select").length>1?p.not(".cannot-select").eq(1).click():r());else if(e(this).parents(".menu").removeClass("collapsed"),"none"!==e(this).css("display")&&!e(this).hasClass("menu-select")&&!e(this).hasClass("cannot-select")){r();var o=e("<div class='menu-wrap'></div>").css("padding-left",m+"px"),u=0,d=0;e(this).parent().not(e(l)).length>0&&(d=parseInt(e(this).parent().css("padding-left").replace("px",""),10)),o.css("margin-left","-"+d+"px"),n(c.replace(/_$/,"")),e(this).addClass("menu-select").wrap(o).find(".menu-hover").removeClass("menu-hover"),1===e(this).children("div:not(.not-menu)").length?(u=parseInt(e(this).children("div:not(.not-menu)").first().css("padding-left").replace("px",""),10),e(this).children("div:not(.not-menu)").first().css("padding-left",u-m+d+"px")):(u=parseInt(e(this).css("padding-left").replace("px",""),10),e(this).css("padding-left",u-m+d+"px"))}t.stopPropagation()})})}function n(t){if(s.remember&&e.cookie("sdMarkMenu",t+":"+a(t.split("_")[0]).attr("name")),e.isFunction(s.onselect)){for(var i=t.split("_"),n="",o=c.eq(i[0]),r=0;i.length>r;r++)n+=o.attr("name")+".",o=o.children("div.menu").eq(i[r+1]);n=n.replace(/\.$/,""),s.onselect(n)}e.isFunction(s.onunload)&&s.onunload()}function a(e){if(!e)return null;for(var t=e.split("_"),i=c.eq(t[0]),n=0;t.length-1>n;n++)i=i.children("div:not(.menu-title, .not-menu)").eq(t[n+1]),i.hasClass("menu-wrap")&&(i=i.children("div:not(.not-menu)").eq(0));return i}function o(){if(!s.remember)return null;try{var t=e.cookie("sdMarkMenu");return t?a(t.split(":")[0]):null}catch(i){return null}}function r(){var t=e(l).find("div.menu-select"),i=0;if(t.length>0){i=parseInt(t.parent().css("margin-left").replace("px",""),10),t.removeClass("menu-select").unwrap(),t.children("div:not(.not-menu)").length>0&&(t=t.children("div:not(.not-menu)").eq(0));var n=parseInt(t.css("padding-left").replace("px",""),10);t.css("padding-left",n+m+i+"px")}}var s=jQuery.extend({oneSmOnly:!0,remember:!0,defaultMenu:"0",onselect:null,onunload:null},t),l=this,c=e(this).children("div:not(.not-menu)"),u=21,d=8,m=3;i(c,1,""),e(l).find("div.not-menu").click(function(e){e.stopPropagation()}),e.extend(this,{focusById:function(e){var t=a(e);t&&t.click()},hide:function(e){var t=a(e);t&&t.hide()},show:function(e){var t=a(e);t&&t.show()}});var p=o();return null===p?this.focusById(s.defaultMenu):p.click(),this}})(jQuery);